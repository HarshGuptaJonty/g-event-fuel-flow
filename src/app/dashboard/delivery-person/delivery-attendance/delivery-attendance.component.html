<div class="delivery-attendance-container">
    <div class="d-flex justify-content-between align-items-center">
        <div class="heading bold-text nowrap">Attendance</div>
        <div class="line2">Updated <span>{{lastUpdatedStr}} </span>
            <span class="refresh" (click)="refreshData(true)" tabindex="0"
                title="Refresh attendance list">refresh</span>.
        </div>
    </div>

    <div class="d-flex align-items-center gap-2 mt-2">
        <select class="form-select form-select-sm select-list" [(ngModel)]="frequencyFilter.year.selected"
            (change)="onFrequencyChange(true)">
            @for (option of frequencyFilter.year.options; track option) {
            <option *ngIf="option>=minDate.year && option<=maxDate.year" value="{{option}}">
                {{ option }}</option>
            }
        </select>
        <select class="form-select form-select-sm select-list" [(ngModel)]="frequencyFilter.month.selected"
            (change)="onFrequencyChange(true)">
            @for (option of frequencyFilter.month.options; track option) {
            <option *ngIf="option.value>=minDate.month && option.value<=maxDate.month" value="{{option.value}}">
                {{ option.label }}</option>
            }
        </select>
        <select class="form-select form-select-sm select-list" [(ngModel)]="frequencyFilter.week.selected"
            (change)="onFrequencyChange()">
            @for (option of frequencyFilter.week.options; track option) {
            <option value="{{option.value}}">
                {{ option.label }}</option>
            }
        </select>
    </div>

    <div class="w-100 table-div mt-3">
        <table *ngIf="processedTableData && processedTableData.length>0" mat-table [dataSource]="dataSource"
            multiTemplateDataRows class="custom-table">
            <tr mat-header-row *matHeaderRowDef="displayedColumns()" class="custom-header-row nowrap"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns();"
                [ngClass]="{'custom-bg-color': row.index % 2 === 0}"></tr>

            <ng-container *ngFor="let column of tableStructure" [matColumnDef]="column.key">
                <th mat-header-cell *matHeaderCellDef class="custom-header-cell">{{column.label}}</th>
                <td mat-cell *matCellDef="let value" class="custom-mat-cell no-border-bottom">
                    <ng-container
                        *ngTemplateOutlet="getTemplate(column.dataType); context: {$implicit: value, column: column}"></ng-container>
                </td>
            </ng-container>
        </table>
    </div>

    <ng-template #checkBox let-value let-column="column">
        <mat-slide-toggle [checked]="value?.[column.key] || false"
            (change)="checkboxUpdated(value, column, $event)"></mat-slide-toggle>
        <!-- <mat-checkbox [checked]="value?.[column.key] || false" (click)="checkboxUpdated(value, column, $event)" tabindex="0"></mat-checkbox> -->
    </ng-template>

    <ng-template #plainText let-value let-column="column">
        <span class="nowrap default-font">{{value?.[column.key]}}</span>
    </ng-template>

    <ng-template #dnameText let-value let-column="column">
        <span class="name-text nowrap" tabindex="0"
            (click)="openProfile(value?.[column.key])">{{getDeliveryPersonName(value?.[column.key])}}</span>
    </ng-template>
</div>
<div class="ai-widget-container d-flex flex-column" *ngIf="aiWidgetService.isWidgetOpen">
    <div class="chat-header d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
            <img src="../../../assets/images/icons/favicon.png" alt="Logo" height="32px" width="32px">
            <div class="margin-left-15">
                <div class="bold-text">AI Assistant</div>
                <div class="smaller-text align-items-center d-flex">
                    <img *ngIf="aiWidgetService.aiStatus === 'ready'" src="../../../assets/images/icons/green-circle.png" alt="Online" height="10px" width="10px" class="margin-right-5">
                    <img *ngIf="aiWidgetService.aiStatus === 'error'" src="../../../assets/images/icons/red-circle.png" alt="Online" height="10px" width="10px" class="margin-right-5">
                    <img *ngIf="aiWidgetService.aiStatus === 'thinking'" src="../../../assets/images/svg/yellow-circle.svg" alt="Online" height="10px" width="10px" class="margin-right-5">
                    {{ aiWidgetService.aiStatus === 'thinking' ? 'Thinking...' : aiWidgetService.aiStatus === 'ready' ? 'Online Now' : 'Error !!!' }}
                </div>
            </div>
        </div>
        <img src="../../../assets/images/icons/white-close.png" alt="Close" height="20px" width="20px" class="ml-auto cursor-pointer" (click)="closeWidget()" />
    </div>
    <div class="chat-messages flex-grow-1">
        <div *ngFor="let message of aiWidgetService.messages" class="message"
            [ngClass]="{'user-message': message.from === 'user', 'ai-message': message.from === 'ai'}">
            <div>
                <div class="smaller-text bold-text" [ngClass]="message.from === 'ai' ? 'black-color' : 'white-color'" >{{message.from === 'ai' ? 'AI Agent' : 'You'}}</div>
                <div class="small-text">{{message.content}}</div>
                <div class="smaller-text secondary-color timestamp">{{formatDateAndTime(message.timestamp)}}</div>
                <div class="action-button smaller-text cursor-pointer" *ngIf="message.action === 'click_to_redirect'" (click)="openProfile(message)">Show me!</div>
            </div>
        </div>
        <div class="thinking" *ngIf="aiWidgetService.aiStatus === 'thinking'">
            <img src="../../../assets/images/gif/writing-loading.gif" alt="Thinking" height="24px" width="40px">
        </div>
    </div>
    <div class="chat-input d-flex align-items-end">
        <textarea [(ngModel)]="userInput" class="input-field flex-grow-1" placeholder="Type your message..." (keyup.enter)="sendMessage()"></textarea>
        <div class="send-button" (click)="sendMessage()">
            <img src="../../../assets/images/icons/send.png" alt="Send" height="18px" width="16px">
        </div>
    </div>
</div>

<div class="ai-widget-container close d-flex flex-column" *ngIf="!aiWidgetService.isWidgetOpen">
    <div class="chat-closed-header d-flex align-items-center justify-content-center cursor-pointer h-100" (click)="openWidget()">
        <img src="../../../assets/images/icons/chatbot.png" alt="AI Chat" height="40px" width="40px">
    </div>
</div>